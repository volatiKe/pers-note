# 多级反馈队列

## 引入

MLFQ 试图解决两方面问题：

* 优化周转时间：虽然可以通过 SJF 或 STCF 实现，但 OS 无法得得知任务运行时间
* 优化响应时间：虽然可以通过 RR 实现，但会增加周转时间

## 基本规则

形式：

* 拥有多个队列
* 每个队列有不同的优先级
* 任一给定时间，一个任务只处于一个队列中

基本规则：

* 规则 1：if priority(A) > priority(B), A runs
* 规则 2：if priority(A) = priority(B), A & B run in RR

MLFQ 执行调度的关键是如何设置任务的优先级：MLFQ 会根据任务表现出的行为动态调整其优先级，如：

* 任务频繁的释放 CPU 资源、等待键盘输入，如果这是交互型进程的行为，为了良好的交互体验，将其保持在高优先级
* 任务长时间占用 CPU 资源，则降低其优先级

## 优先级调整规则

考虑如下场景：

* 可能频繁放弃 CPU 资源的一堆短时间运行的交互型任务
* 一些长时间运行的、不关心响应时间的计算密集型任务

优先级调整规则：

* 规则 3：当任务到达时，给予最高优先级
* 规则 4a：如果任务在运行期间使用了一个完整的时间片，则降低其优先级
* 规则 4b：如果在一个时间片结束之前释放了 CPU 资源，则优先级不变
表达
* 慢语速

系统介绍
* 只面向度小满理财，专注于解决基金产品在交易过程中的资金流管理
* 处于交易和理财支付之间
* 根据资金位置的不同分为：
* 上行：支付 -> 销售
* 下行：销售 -> 支付

业务流程：
* 支付：卡支付
* 清结算：下行款
	* 交易确认后清算
		* 一清结果报监管
		* （离线任务出信息流和资金流文件）也可以二清结果做信息流，一清结果走资金流

为什么重构（项目价值）
* 收敛服务、配置、解耦 activiti 引擎，降低维护成本
* 重新确定领域边界
* 便于后期承载更多清结算业务逻辑

功能
* 清算：三要素
* 结算：资金位置的感知、推进、触发划拨
* 支付：抽象度小满支付的资金划拨能力、资产互转

技术
* 清结算
	* 文件读取、生成（二次聚合）
	* 多线程批处理
	* 分布式锁 + 幂等
	* 异步处理
	* spring event

架构

1. 交易侧文件给到清算
2. 清算解析文件、校验、清算、通知结算（批处理）
3. 清算直接或异步通知结算开启结算
4. 结算被动接受请求或主动调用来感知或推进资金位置（批次维度）
5. 结算触发资金划拨（明细维度）
6. 支付回调结算，结算回调交易

优缺点

优点
1. 架构清晰
2. 领域划分明确

改进
1. 大文件处理
2. 信息流不必过结算
3. 只支持文件方式清结算（接口方式的明细处理）

亮点
1. 引入一清、二清的概念，可以（赎转购）将销售清结算和支付清结算打通
2. 无资损、不影响业务地分阶段切流


切流
* 直接从切 settle 说
* 流量复制
	* 清算修改代码
	* 清算双写老结算
	* 清算双写老新
	* 清算单写老和新
	* 清算单写新
* 其他
	* 老结算切一部分到新支付
	* 单写老和新时加锁互查
	* 对外汇总金额
	* 老转发请求到新
	* 写新老表由配置驱动 dao 层切换

成长
* 独立负责单一领域核心服务的重构全流程，梳理掌握理财清结算全业务
* 重构里程碑多，需要协调、考虑各方资源
* 对资金服务的各种变更需要有完整、规范的流程来避免问题发生